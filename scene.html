<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/sylvester/0.1.3/sylvester.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.9.1/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.js"></script>
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.0/spectrum.min.css">

<!-- <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>  --> 
<script src="/medium-editor-master/dist/js/medium-editor.min.js"></script>
<link rel="stylesheet" href="/medium-editor-master/dist/css/medium-editor.min.css" type="text/css" media="screen" charset="utf-8">
<link rel="stylesheet" href="/medium-editor-master/dist/css/themes/beagle.css" type="text/css" media="screen" charset="utf-8">

    
    <script src="/products.js"></script>
    <script src="/productViewManager.js"></script>

</head>

<body>
<!-- <div id="holder" style="height: 100%;"></div> -->
<style>

.container > *{
/*     display: inline-block;
    vertical-align: top;   */

}
    html,
    body{
            height: 100%;
            margin: auto;
/*             overflow: hidden; */
        }
        .loadedFrames > * {
            visibility: hidden;
        }
        .shadows > * {
            visibility: hidden;
        }
        .visible{
            visibility: visible;
        }
        .invisible{
             width: 1px;
             height: 1px;
        }
    svg {
        width: 100%;
        height: 100%;
        border: solid 1px red;

        }

    .isolate { isolation: isolate; }
    #product-design{width:800px;height:800px; border: solid 1px black;}





.rotWhlCircumference,.sclWhlCircumference {
  fill: none;
  stroke: rgba(0,0,0,0.4);
  stroke-width: 5px;
}

.rotationWheelHandle,.scaleWheelHandle circle:hover {
  cursor: pointer;
}

.rotationWheelHandle,.scaleWheelHandle circle {
  fill: #25a8e0;
/*   stroke: #4f4f4f;
  stroke-width: 1.5px; */
}

.rotationWheelHandle circle.dragging,.scaleWheelHandle circle.dragging {
  fill: #f89b11;
/*   stroke: brown; */
}


.masked {
  mask:url('#MaskCanvas');
  clip-path:url('#myClip');
}
.handleHide{
    pointer-events: none;
    visibility: hidden;
}


    
</style>

<div class="container">

<div id="product-design">


    
        <select id="frameColor">
        
        <option value="Oak">Oak</option>
        <option value="LightBrown">LightBrown</option>
        <option value="DarkBrown">DarkBrown</option>
        <option value="White">White</option> 
        <option value="Black">Black</option>
        <option value="Gold">Gold</option>
        <option value="Silver">Silver</option>
        
        </select>
        
       
        <select id="isFramed">
        
        <option value="true">with frame</option>
        <option value="false">no frame</option>
        
        

        </select>
       
        <select id="identifier">
        <option value="Horizontal32">Horizontal32</option>
    <option value="Square">Square</option> 

    <option value="Horizontal21">Horizontal21</option>
    <option value="Horizontal31">Horizontal31</option>
    <option value="Vertical23">Vertical23</option>
    <option value="Vertical12">Vertical12</option>
    <option value="Vertical13">Vertical13</option>   
    
    <option value="MultiSet212">MultiSet212</option>
    <option value="MultiSet313">MultiSet313</option>
    <option value="MultiSet122">MultiSet122</option>
    <option value="MultiSet133">MultiSet133</option>
    <option value="MultiSet595">MultiSet595</option>
    <option value="MultiSet311">MultiSet311</option>
    <option value="MultiSet411">MultiSet411</option>
    <option value="MultiSet321">MultiSet321</option>
    <option value="MultiSet331">MultiSet331</option>
    <option value="MultiSet221">MultiSet221</option>
        

        </select>
       
        <select id="size">
        <option value="s">Small</option>
        <option value="m">Medium</option>
        <option value="l">Large</option>
        
         
    
        </select>


<svg id="mainSVG" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 1000 1000">

<g id="current" >

    <g class="masks">   
    <mask id="MaskCanvas">
         <image id="CanvasAlpha" xlink:href="assets/canvasprint/Square/30x30-s-CanvasAlpha.png"></image>   
    </mask>
     <mask id="MaskFrame">
         <image id="FrameAlpha" xlink:href="assets/canvasprint/Square/30x30-s-FrameAlpha.png"></image>    
    </mask>
    </g>


    <clipPath id="myClip" >

    </clipPath>

    
    <filter id="invert">
        <feColorMatrix  in="SourceGraphic" type="matrix" values="-1 0 0 0 1 
                                                                  0 -1 0 0 1 
                                                                  0 0 -1 0 1
                                                                  0 0 0 1 0"/>
    </filter>
    
    <g class="shadows">
    <image id="ShadowFrameAlpha" xlink:href="assets/canvasprint/Square/30x30-s-FrameShadowAlpha.png" style="filter: url('#invert');"></image>
    <image id="ShadowCanvasAlpha" xlink:href="assets/canvasprint/Square/30x30-s-CanvasShadowAlpha.png" style="filter: url('#invert');"></image>
    </g>
    
    <g class="loadedFrames">
        <image id="Black" xlink:href="assets/canvasprint/Square/30x30-s-Black.png"></image>
        <image id="Oak" xlink:href="assets/canvasprint/Square/30x30-s-Oak.png"></image>
        <image id="White" xlink:href="assets/canvasprint/Square/30x30-s-White.png"></image>
        <image id="DarkBrown" xlink:href="assets/canvasprint/Square/30x30-s-DarkBrown.png"></image>
        <image id="LightBrown" xlink:href="assets/canvasprint/Square/30x30-s-LightBrown.png"></image>
        <image id="Silver" xlink:href="assets/canvasprint/Square/30x30-s-Silver.png"></image>
        <image id="Gold" xlink:href="assets/canvasprint/Square/30x30-s-Gold.png"></image>
    </g>
    
    <g class="isolate" >    
    
    <image id="DiffuseCanvas" preserveAspectRatio="xMaxYMax meet" xlink:href="assets/canvasprint/Square/30x30-s-DiffuseCanvas.png"></image>
    <image id="IlluminationIndirect" xlink:href="assets/canvasprint/Square/30x30-s-IlluminationIndirect.png" style="mix-blend-mode:soft-light" opacity="0.5"></image>
    <image id="SpecularShading" xlink:href="assets/canvasprint/Square/30x30-s-SpecularShading.png" style="mix-blend-mode:lighten"></image>
<svg id="contentWrapper"  style="mix-blend-mode:multiply;" >

<image id="content" xlink:href="assets/aa.JPG" ></image>

<!-- <foreignObject width="200" height="200" 
     requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility">
   
<textarea cols="30" rows="10" class="editable" placeholder="Hello"></textarea>

</foreignObject> -->


</svg>


</svg>


<script type="text/javascript" src="utils.js"></script>

<script>


function initScene(){

var productViewManager = new ProductViewManager(products,"assets/canvasprint/");

var animationFadeIn = function(pvm,callback) {
    
    $("#current").animate({ opacity: 1 },function(){
        if(callback){
        callback();
        }
    }); 
    }


var animationFadeOut = function(pvm,callback) {
    $("#current").animate({ opacity: 0 },function(){
        if(callback){
        callback();
        }
    }); 
    } 


productViewManager.setFrameColor();
productViewManager.setFrameStatus();
productViewManager.setCanvasIdentifier(animationFadeOut,animationFadeIn);
productViewManager.setCanvasSize(animationFadeOut,animationFadeIn);
var thisProduct = testRect($('#identifier').val(),$('#size').val(),squareBoxSize);

d3.select("#content").attr('x',thisProduct.designX).attr('y',thisProduct.designY);

$('#frameColor').bind('change', function () {
        productViewManager.setFrameColor()              
});

$('#isFramed').bind('change', function () {
        productViewManager.setFrameStatus() 

});
$('#identifier').bind('change', function () {

    testRect($(this).val(),$('#size').val(),squareBoxSize);
        productViewManager.setCanvasIdentifier(animationFadeOut,animationFadeIn) 
});

$('#size').bind('change', function (e) {
    testRect($('#identifier').val(),$(this).val(),squareBoxSize);
        productViewManager.setCanvasSize(animationFadeOut,animationFadeIn);

    
});


$('#content').click(function(e){


    e.stopPropagation();

d3.select('#contentWrapper')
.attr('clip-path',null)
.attr('mask',null)
;





    if(able){

    pft('#mainSVG','#content',{
  handles:{
    r:10,
    stroke:'blue',
    strokeWidth:1,
    fill:'cyan',
    tcOffset:-30
  }
});


    }
    else{
        $('#handleGroup').removeClass('handleHide');
    }
    able=false;

});
$('#mainSVG').click(function(e){

e.stopPropagation();

d3.select('#contentWrapper')
.attr('clip-path','url(#myClip)')
.attr('mask','url(#MaskCanvas)')
;


    $('#handleGroup').addClass('handleHide');

});





}
initScene();
var able = true;
</script>    

<script type="text/javascript" src="pft.js"></script>


</html>









